<?
//Do not edit this file.  Instead, set these variables in config.local.php, which will automatically be included if it exists.

$config['Site title'] = "Map";
$config['Site keywords'] = "map,interactive";
$config['Site description'] = "Interactive Map";
$config['default lat'] = 50.9355;
$config['default long'] = -1.39595;
$config['default zoom'] = 17;
$config['default map'] = "'Map2'";
$config['datasource'] = 'sqldemo';
$config['enabled'] = array('search', 'geobutton', 'toggleicons');
$config['categories']['Transportation'] = 'Transport';
$config['categories']['Restaurants-and-Hotels'] = 'Catering and Accommodation';
$config['categories']['Offices'] = 'Services';
$config['categories']['Culture-and-Entertainment'] = 'Culture and Entertainment';
$config['categories']['Health'] = 'Health and Beauty';
$config['categories']['Tourism'] = 'Tourism and Religion';
$config['categories']['Stores'] = 'Retail';
$config['categories']['Education'] = 'Education';
$config['categories']['Sports'] = 'Sports';

error_reporting(0);
$version = $_GET['v'];
$versionparts = explode('_', $version);

if(file_exists('config.local.php'))
{
	include 'config.local.php';
}

$path = '.';
if(preg_match('/^[a-zA-Z0-9_-]+$/', $_GET['v']))
{
	$version = $versionparts[0];
	$path = $version;
	if(file_exists('config.'.$version.'.php'))
	{
		include 'config.'.$version.'.php';
	}
}

if(!is_array($config['datasource']))
{
	$config['datasource'] = array($config['datasource']);
}

function has($id) {
	global $config;
	return in_array($id, $config['enabled']);
}

function show($id) {
	global $config;
	if(!in_array($id, $config['enabled']))
	{
		echo "style='display:none'";
	}
}

function getAllMatches($q, $cats)
{
	global $config;
	
	$labellimit = 100;

	$pos = array();
	$label = array();
	$type = array();
	$url = array();
	$icon = array();

	foreach($config['datasource'] as $ds)
	{
		$dsclass = ucwords($ds).'DataSource';
		list($npos, $nlabel, $ntype, $nurl, $nicon) = call_user_func(array($dsclass, 'getEntries'), $q, $cats);
		foreach($npos as $k => $v)
			$pos[$k] += $v;
		foreach($nlabel as $k => $v)
			$label[$k] += $v;
		foreach($ntype as $k => $v)
			$type[$k] = $v;
		foreach($nurl as $k => $v)
			$url[$k] = $v;
		foreach($nicon as $k => $v)
			$icon[$k] = $v;
	}
	
	foreach($label as $k => $v)
	{
		$label[$k] = (1000000-$v).'/'.$k;
	}
	asort($label);
	if(count($label) > $labellimit)
		$label = array_slice($label, 0,$labellimit);

	return array($pos, $label, $type, $url, $icon);
}

class DataSource{
	static function getAll(){}
	static function getEntries($q, $cats){}
	static function getDataSets(){}
	static function getDataSetExtras(){}
	static function getAllSites(){}
	static function getAllBuildings(){}
	static function processURI($uri){return false;}
	
	static $iconpath = 'http://data.southampton.ac.uk/map-icons/';
	
	static function convertIcon($icon)
	{	
		return $icon;
	}
}

function getEnabledCategories()
{
	if($_GET['ec'] == "")
	{
		return array('Transportation','Restaurants-and-Hotels','Offices','Culture-and-Entertainment', 'Health', 'Tourism', 'Stores', 'Education', 'Sports');
	}
	else
	{
		return explode(',', $_GET['ec']);
	}
}

foreach($config['datasource'] as $ds)
{
	include_once 'ds/'.$ds.'.php';
}

?>
